___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "TrustProfile",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "The Trustprofile tag installs the TrustProfile Sidebar on your site. Using the sidebar, your visitors can see your TrustProfile status and reviews at a glance.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "Shop ID",
    "displayName": "Shop ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "POSITIVE_NUMBER"
      }
    ],
    "help": "Get the Shop ID from the Installation page in the TrustProfile dashboard."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const encodeUriComponent = require('encodeUriComponent');
const getTimestampMillis = require('getTimestampMillis');
const makeInteger = require('makeInteger');
const Math = require('Math');
const logToConsole = require('logToConsole');

const id = makeInteger(data['Shop ID']);
const url = 'https://dashboard.trustprofile.com/sidebar.js?id=' + encodeUriComponent(id) + '&c=' + cachebuster(10, id);

injectScript(url, data.gtmOnSuccess, data.gtmOnFailure);

function cachebuster(refreshMinutes, id) {
    var now = getTimestampMillis();
    var interval = refreshMinutes * 60 * 1000;
    var shift = ((id * 2654435769) % 40503)/40503 * interval;
    return Math.floor((now + shift) / interval);
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://dashboard.trustprofile.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Test 1
  code: |-
    const mockData = {
      "Shop ID": 4000041,
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 09/09/2022, 14:47:19


